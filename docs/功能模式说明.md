# 功能模式说明

## 核心理念

Email Digest Browser 采用模块化设计，核心功能（网页浏览和内容保存）是独立的，邮件同步和 LLM 摘要都是可选的增强功能。

## 三种工作模式

### 1. 基础模式（仅本地存储）

**功能**:
- ✅ 浏览网页
- ✅ 捕获页面内容
- ✅ 本地存储文摘
- ✅ 搜索和管理文摘
- ✅ 查看历史记录

**不需要**:
- ❌ 邮箱配置
- ❌ LLM API 配置

**适用场景**:
- 纯本地使用
- 隐私要求高
- 不需要跨设备同步
- 不需要 AI 摘要

### 2. 邮箱同步模式

**功能**:
- ✅ 基础模式的所有功能
- ✅ 将文摘发送到邮箱
- ✅ 从邮箱读取文摘
- ✅ 跨设备同步

**需要**:
- ✅ 配置 SMTP（发送）
- ✅ 配置 IMAP（接收）

**不需要**:
- ❌ LLM API 配置

**适用场景**:
- 需要跨设备同步
- 使用邮箱作为备份
- 多台电脑使用

### 3. 完整模式（邮箱 + LLM）

**功能**:
- ✅ 邮箱同步模式的所有功能
- ✅ AI 自动生成摘要
- ✅ 智能内容提取
- ✅ 长文章总结

**需要**:
- ✅ 配置 SMTP/IMAP
- ✅ 配置 LLM API

**适用场景**:
- 需要 AI 辅助
- 处理长文章
- 自动生成摘要

## 功能对比表

| 功能 | 基础模式 | 邮箱同步 | 完整模式 |
|------|---------|---------|---------|
| 浏览网页 | ✅ | ✅ | ✅ |
| 捕获内容 | ✅ | ✅ | ✅ |
| 本地存储 | ✅ | ✅ | ✅ |
| 搜索管理 | ✅ | ✅ | ✅ |
| 邮件发送 | ❌ | ✅ | ✅ |
| 邮件读取 | ❌ | ✅ | ✅ |
| 跨设备同步 | ❌ | ✅ | ✅ |
| AI 摘要 | ❌ | ❌ | ✅ |
| 内容总结 | ❌ | ❌ | ✅ |

## 配置要求

### 基础模式
```javascript
// 无需配置，开箱即用
```

### 邮箱同步模式
```javascript
{
  email: {
    smtp: {
      host: 'smtp.example.com',
      port: 587,
      secure: true,
      auth: {
        user: 'your-email@example.com',
        pass: 'your-password'
      }
    },
    imap: {
      host: 'imap.example.com',
      port: 993,
      secure: true,
      auth: {
        user: 'your-email@example.com',
        pass: 'your-password'
      },
      folder: 'INBOX'
    }
  }
}
```

### 完整模式
```javascript
{
  email: { /* 同上 */ },
  llm: {
    provider: 'openai',
    apiKey: 'sk-...',
    model: 'gpt-3.5-turbo',
    maxTokens: 1000
  }
}
```

## UI 行为

### 设置界面

根据配置状态显示不同的 UI：

```
┌─────────────────────────────────┐
│ 邮箱配置                         │
│ □ 启用邮箱同步                   │ ← 可选
│   [配置 SMTP/IMAP]              │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ LLM 配置                         │
│ □ 启用 AI 摘要                   │ ← 可选
│   [配置 API]                    │
└─────────────────────────────────┘
```

### 功能按钮

根据配置动态显示：

```
工具栏：
  [捕获]              ← 始终可用
  [同步邮箱]          ← 仅当配置了邮箱时显示
  [生成摘要]          ← 仅当配置了 LLM 时显示
```

### 文摘详情页

```
┌────────────────────────────────┐
│ 标题                            │
│ URL                             │
│ ────────────────────────────   │
│                                 │
│ AI 摘要                         │ ← 仅当有摘要时显示
│ [生成摘要]                      │ ← 仅当配置了 LLM 时显示
│                                 │
│ 正文内容                        │
│                                 │
│ [保存到邮箱]                    │ ← 仅当配置了邮箱时显示
└────────────────────────────────┘
```

## 首次使用引导

### 欢迎界面

```
欢迎使用 Email Digest Browser！

请选择工作模式：

○ 仅本地使用
  不需要任何配置，数据保存在本地

○ 启用邮箱同步
  可以跨设备同步，需要配置邮箱

○ 完整功能（邮箱 + AI）
  包含所有功能，需要配置邮箱和 LLM API

[开始使用]
```

### 可以稍后配置

用户可以先使用基础模式，随时在设置中启用邮箱或 LLM：

```
设置 → 启用邮箱同步 → 配置 SMTP/IMAP → 开始使用
设置 → 启用 AI 摘要 → 配置 LLM API → 开始使用
```

## 数据流

### 基础模式
```
网页 → 内容提取 → 本地存储 → 显示
```

### 邮箱同步模式
```
网页 → 内容提取 → 本地存储 → SMTP发送 → 邮箱
                     ↑
                IMAP读取 ← 邮箱
```

### 完整模式
```
网页 → 内容提取 → LLM摘要 → 本地存储 → SMTP发送 → 邮箱
                              ↑
                         IMAP读取 ← 邮箱
```

## 错误处理

### 邮件发送失败

- 不影响本地保存
- 显示错误提示
- 可以稍后手动重试

### LLM 调用失败

- 不影响内容保存
- 保存原始内容
- 可以稍后手动生成摘要

### 原则

**核心功能永远可用** - 即使邮件和 LLM 都失败，用户仍然可以：
- 浏览网页
- 保存内容
- 查看历史记录

## 迁移路径

用户可以随时升级或降级模式：

```
基础模式 ─→ 邮箱同步 ─→ 完整模式
         ←─         ←─
```

**升级**: 在设置中配置邮箱/LLM
**降级**: 在设置中禁用邮箱/LLM（数据保留）

## 实现建议

### 配置检查

```typescript
// 检查是否启用了邮箱功能
function isEmailEnabled(): boolean {
  const config = getConfig();
  return !!(config.email?.smtp && config.email?.imap);
}

// 检查是否启用了 LLM 功能
function isLLMEnabled(): boolean {
  const config = getConfig();
  return !!(config.llm?.apiKey);
}
```

### 条件渲染

```tsx
// 仅当启用邮箱时显示同步按钮
{isEmailEnabled() && (
  <button onClick={handleSync}>
    同步邮箱
  </button>
)}

// 仅当启用 LLM 时显示生成摘要按钮
{isLLMEnabled() && (
  <button onClick={handleGenerateSummary}>
    生成摘要
  </button>
)}
```

### 优雅降级

```typescript
async function saveDigest(digest: DigestData) {
  // 1. 本地保存（必须）
  await storage.save(digest);

  // 2. LLM 摘要（可选）
  if (isLLMEnabled()) {
    try {
      digest.summary = await llm.summarize(digest.content);
      await storage.update(digest);
    } catch (error) {
      console.warn('LLM failed, continuing without summary:', error);
    }
  }

  // 3. 邮件发送（可选）
  if (isEmailEnabled()) {
    try {
      await smtp.sendDigest(digest);
    } catch (error) {
      console.warn('Email send failed, saved locally:', error);
      // 可以稍后重试
    }
  }
}
```

## 总结

这种设计让应用更加灵活：

1. **降低使用门槛** - 用户可以先体验核心功能，无需配置
2. **渐进式增强** - 需要时再启用高级功能
3. **提高可靠性** - 核心功能不依赖外部服务
4. **更好的隐私** - 用户可以选择完全本地使用
5. **适应不同场景** - 满足不同用户的需求
