# 开发指南

## 环境要求

- Node.js >= 18.0.0
- npm >= 9.0.0
- Git

## 快速开始

### 1. 克隆项目

```bash
git clone git@github.com:minghua-li/email-digest.git
cd email-digest
```

### 2. 安装依赖

```bash
npm install
```

### 3. 启动开发服务器

```bash
npm run dev
```

这将启动Vite开发服务器和Electron应用。

### 4. 构建生产版本

```bash
npm run build
```

## 项目结构

```
email-digest/
├── src/
│   ├── main/              # 主进程
│   │   ├── index.ts       # 主进程入口
│   │   ├── preload.ts     # 预加载脚本
│   │   ├── window/        # 窗口管理
│   │   ├── smtp/          # SMTP客户端
│   │   ├── imap/          # IMAP客户端
│   │   ├── storage/       # 本地存储
│   │   ├── llm/           # LLM集成
│   │   └── ipc/           # IPC通信
│   │
│   ├── renderer/          # 渲染进程
│   │   ├── App.tsx        # 主应用组件
│   │   ├── main.tsx       # 渲染进程入口
│   │   ├── components/    # UI组件
│   │   ├── pages/         # 页面组件
│   │   ├── stores/        # Zustand状态管理
│   │   ├── hooks/         # React Hooks
│   │   └── utils/         # 工具函数
│   │
│   └── shared/            # 共享代码
│       ├── types/         # TypeScript类型定义
│       ├── utils/         # 共享工具函数
│       └── constants/     # 常量定义
│
├── docs/                  # 文档
├── tests/                 # 测试文件
├── scripts/               # 构建脚本
└── dist/                  # 构建输出

## 开发命令

- `npm run dev` - 启动开发服务器
- `npm run build` - 构建生产版本
- `npm run lint` - 运行ESLint代码检查
- `npm run format` - 格式化代码（Prettier）
- `npm run type-check` - TypeScript类型检查
- `npm run electron:dev` - 启动Electron开发模式
- `npm run electron:build` - 打包Electron应用

## 技术栈

### 主进程 (Main Process)

- **Electron** - 桌面应用框架
- **nodemailer** - SMTP客户端
- **imap** - IMAP客户端
- **mailparser** - 邮件解析
- **Node.js fs** - 文件系统操作

### 渲染进程 (Renderer Process)

- **React 18** - UI框架
- **TypeScript 5** - 类型系统
- **Zustand** - 状态管理
- **Tailwind CSS** - 样式框架
- **@mozilla/readability** - 内容提取

### 构建工具

- **Vite** - 构建工具和开发服务器
- **vite-plugin-electron** - Electron集成
- **electron-builder** - 应用打包
- **ESLint** - 代码检查
- **Prettier** - 代码格式化

## 代码规范

### TypeScript

- 使用严格模式（`strict: true`）
- 避免使用 `any`，尽量使用具体类型
- 导出的接口和类型使用 PascalCase
- 函数和变量使用 camelCase

### React

- 使用函数组件和 Hooks
- 组件文件使用 `.tsx` 扩展名
- 组件名使用 PascalCase

### 样式

- 优先使用 Tailwind CSS 工具类
- 避免内联样式
- 组件特定样式可以使用 CSS Modules

### 提交信息

遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

- `feat:` - 新功能
- `fix:` - Bug修复
- `docs:` - 文档更新
- `style:` - 代码格式调整
- `refactor:` - 代码重构
- `test:` - 测试相关
- `chore:` - 构建/工具相关

## 调试

### 主进程调试

1. 在 VSCode 中打开调试面板
2. 选择 "Attach to Main Process"
3. 启动应用后，点击调试按钮

### 渲染进程调试

在应用运行时按 `Cmd+Option+I` (macOS) 或 `Ctrl+Shift+I` (Windows/Linux) 打开开发者工具。

### 日志

- 主进程日志：终端输出
- 渲染进程日志：开发者工具控制台

## 常见问题

### 依赖安装失败

如果 `npm install` 失败，尝试：

```bash
rm -rf node_modules package-lock.json
npm install
```

### Electron 启动失败

确保已经正确安装了 Electron：

```bash
npm rebuild electron
```

### 类型错误

运行类型检查找出问题：

```bash
npm run type-check
```

## 贡献指南

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'feat: add some amazing feature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 许可证

MIT License - 详见 [LICENSE](../LICENSE) 文件
