# 邮件文摘浏览器 - 需求文档（Electron版本）

## 1. 项目概述

### 1.1 项目名称
邮件文摘浏览器 (Email Digest Browser)

### 1.2 项目简介
一款基于Electron的开源桌面应用，集成了浏览器功能和智能内容管理。利用邮件系统作为数据存储介质，结合大语言模型(LLM)能力，为用户提供自动化的内容收集、整理和摘要服务。用户可以在应用内浏览网页、保存内容到邮箱，并通过AI生成智能摘要，实现个人知识库的积累与管理。

### 1.3 产品定位
**开源的个人知识库浏览器** - 一个带有内容捕获和AI摘要功能的极简浏览器，强调数据自主性和隐私安全。

### 1.4 核心价值
- **一体化体验**：浏览器 + 内容管理 + AI摘要，一个应用完成所有操作
- **数据自主**：数据存储在用户自己的邮箱中，完全自主可控
- **开源透明**：完全开源，开发者友好，无需复杂配置
- **智能摘要**：利用LLM自动生成内容摘要，节省阅读时间
- **跨平台**：支持Windows/macOS/Linux
- **零服务器成本**：利用现有邮件服务，无需额外服务器
- **隐私优先**：所有敏感信息本地加密存储

## 2. 目标用户

### 2.1 主要用户群体
- 知识工作者：需要大量收集和整理网络资料
- 研究人员：需要保存和摘要学术文章、技术文档
- 内容创作者：需要收集灵感和素材
- 学生：需要整理学习资料
- 信息爱好者：喜欢收集和管理有价值的网络内容

### 2.2 用户痛点
- 网页收藏分散在不同平台，管理困难
- 内容过多，来不及详细阅读
- 需要跨设备访问收藏内容
- 担心第三方服务的数据安全和隐私
- 不想为额外的存储服务付费
- 现有浏览器书签功能不够强大
- 稍后阅读应用依赖特定服务商

## 3. 核心功能模块

### 3.1 浏览器模块
**功能描述**：内置的网页浏览功能

**主要功能**：
- 完整的网页浏览能力（基于Chromium）
- 地址栏导航
- 前进/后退/刷新
- 多标签页支持（可选MVP范围外）
- 书签和历史记录

**UI设计**：
- 极简Chrome风格
- 地址栏 + 浏览区域
- 最小化的工具栏

### 3.2 内容捕获模块
**功能描述**：快速捕获当前浏览的网页内容

**主要功能**：
- 使用Readability自动提取正文内容
- 内容预览和手动裁剪调整
- 选择性保存（全文/选中部分）
- 自动提取标题、URL、作者、发布时间等元信息
- 完整保存图片（不依赖外部URL）

**交互方式**：
- 工具栏保存按钮
- 右键菜单（选中内容保存）
- 快捷键（Cmd/Ctrl+S）

### 3.3 邮件存储模块
**功能描述**：将捕获的内容通过SMTP发送到用户邮箱，通过IMAP读取同步

**核心理念**：邮箱仅作为数据存储介质，不受限于传统邮件格式

**主要功能**：
- 邮箱账户配置（用户输入邮箱地址和密码/应用专用密码）
  - 支持所有提供SMTP/IMAP的邮箱服务商
  - Gmail、Outlook、QQ邮箱、163邮箱等
  - 使用nodemailer处理SMTP
  - 使用node-imap处理IMAP
- 数据存储策略：
  - 分离存储：HTML邮件和JSON数据分别存储
  - 通过邮件主题标记关联和区分
  - 图片单独存储（避免单封邮件过大，限制5MB）
- 批量发送队列管理
- 手动同步机制（用户点击同步按钮）

**数据存储结构**：
```
邮件1 - HTML格式（可在邮箱中直接阅读）：
主题：[EmailDigest][HTML] 标题 - 日期 - ID
正文：格式化的HTML内容，包含摘要和正文

邮件2 - JSON格式（供程序解析）：
主题：[EmailDigest][JSON] 标题 - 日期 - ID
正文：BASE64编码的JSON数据

邮件3+ - 图片数据：
主题：[EmailDigest][IMAGE] 父文章ID - 图片序号
正文：图片的BASE64编码
```

### 3.4 LLM摘要模块
**功能描述**：利用大语言模型生成内容摘要

**主要功能**：
- 自动生成内容摘要（可配置摘要长度）
- 提取关键词和核心观点
- 支持多种LLM提供商（**用户自提供API Key**）
  - OpenAI (GPT-3.5/GPT-4)
  - Anthropic (Claude)
  - Google (Gemini)
  - 本地模型（Ollama）
  - 国内LLM（文心一言、通义千问、智谱等）
- 自定义提示词模板
- 摘要语言选择（中文/英文/多语言）
- 批量处理模式

**摘要类型**：
- 简短摘要（1-2句话）
- 详细摘要（段落形式）
- 要点列表（bullet points）
- 问答形式（Q&A）
- 自定义格式

### 3.5 内容管理模块
**功能描述**：侧边栏方式管理已保存的内容

**主要功能**：
- 浏览历史保存记录
- 搜索功能（标题、内容、标签）
- 分类和标签管理
- 收藏夹/文件夹结构
- 内容编辑和备注
- 删除和归档
- 导出功能（Markdown、PDF、HTML）

**界面展示**：
- **侧边栏布局**：始终显示在窗口左侧或右侧，可折叠/展开
- 列表视图：显示标题、摘要、日期
- 卡片视图：更直观的展示
- 时间线视图：按时间排序
- 标签云：快速分类浏览
- 点击条目：在主浏览区域显示详情

### 3.6 同步与检索模块
**功能描述**：从邮箱读取和同步内容

**主要功能**：
- **手动同步**：用户点击同步按钮从邮箱获取内容
- 增量同步，避免重复处理
- 本地文件系统缓存，提升访问速度
- 全文搜索
- 高级筛选（按日期、标签、来源网站等）

### 3.7 设置与配置模块
**功能描述**：个性化配置

**主要功能**：
- 邮箱账户设置（**用户自配置SMTP凭据**）
- LLM API配置（**用户自提供API Key**）
- 保存行为设置（自动/手动摘要）
- 界面主题（浅色/深色）
- 快捷键自定义
- 数据导入/导出
- 隐私设置

## 4. 技术架构

### 4.1 技术栈（Electron桌面应用）
- **应用框架**：Electron（最新稳定版）
- **前端框架**：React 18+
- **状态管理**：Zustand 或 Redux Toolkit
- **样式方案**：Tailwind CSS
- **构建工具**：Vite + electron-builder
- **类型检查**：TypeScript 5.0+
- **进程架构**：
  - 主进程：处理SMTP/IMAP、文件系统、LLM API调用
  - 渲染进程：UI界面和用户交互
  - BrowserView：显示网页内容

### 4.2 邮件协议实现
- **SMTP客户端**：
  - 使用**nodemailer**（成熟的Node.js邮件库）
  - 支持所有提供SMTP的邮箱服务商
  - 认证方式：PLAIN、LOGIN、XOAUTH2（根据需要）
  - TLS/SSL加密通信
  - 队列管理和重试机制

- **IMAP客户端**：
  - 使用**node-imap** 或 **imap-simple**
  - 手动触发同步
  - 解析自定义邮件格式（HTML和JSON）
  - 增量同步算法

### 4.3 本地存储
- **文件系统**：使用Node.js fs模块（取代IndexedDB）
  - 用户数据目录：`app.getPath('userData')`
  - 文件结构：
    ```
    ~/Library/Application Support/EmailDigest/
    ├── config/          # 配置文件（加密）
    ├── cache/           # 本地缓存
    │   ├── metadata/    # 文章元数据（仅文字）
    │   └── articles/    # 完整文章数据
    └── temp/            # 临时文件
    ```
- **缓存策略**：仅缓存元数据和文字内容，图片需要时从邮箱获取

### 4.4 LLM集成
- **API调用方式**：
  - 在主进程中使用axios调用RESTful API
  - 支持流式响应（streaming）
  - 长文分段处理后合并
- **安全性**：
  - API Key加密存储（PIN码加密）
  - 仅在本地处理敏感信息
  - 不向第三方服务器发送用户数据（除了必要的LLM API调用）

### 4.5 内容提取
- **提取库**：@mozilla/readability
- **执行位置**：在BrowserView的webContents中执行JavaScript
- **处理流程**：
  ```javascript
  // 在渲染进程中提取
  browserView.webContents.executeJavaScript(`
    const article = new Readability(document).parse();
    return article;
  `);
  ```

### 4.6 系统架构图
```
┌───────────────────────────────────────────────────────┐
│              Electron 主窗口                           │
│  ┌──────────────────────────────────────────────────┐ │
│  │  地址栏 [URL输入] [保存] [同步] [设置]             │ │
│  ├────────────┬─────────────────────────────────────┤ │
│  │  侧边栏    │    BrowserView (网页浏览区域)        │ │
│  │            │                                      │ │
│  │  文摘列表  │    Chromium 渲染网页内容              │ │
│  │  - 文章1   │                                      │ │
│  │  - 文章2   │    执行 Readability 提取内容          │ │
│  │  - 文章3   │                                      │ │
│  │            │                                      │ │
│  │  [搜索框]  │                                      │ │
│  └────────────┴─────────────────────────────────────┘ │
└───────────────────────────────────────────────────────┘
           ↕                    ↕
    ┌──────────────┐    ┌──────────────┐
    │ 主进程        │    │  渲染进程     │
    │              │    │              │
    │ - SMTP/IMAP  │    │ - React UI   │
    │ - nodemailer │    │ - 状态管理   │
    │ - node-imap  │    │ - 用户交互   │
    │ - LLM API    │    │              │
    │ - 文件系统   │    │              │
    └──────────────┘    └──────────────┘
           ↕
    ┌──────────────┐
    │ 外部服务      │
    │ - 邮箱服务器  │
    │ - LLM API    │
    └──────────────┘
```

## 5. 用户使用流程

### 5.1 首次使用流程
1. 下载并安装Electron应用
2. 启动应用，进入欢迎界面
3. **设置PIN码**（用于加密敏感信息）
4. 配置邮箱账户
   - 输入邮箱地址
   - 输入密码或应用专用密码
   - 自动检测SMTP/IMAP配置（或手动输入）
   - 测试连接
5. 配置LLM服务（可选，稍后配置）
   - 选择LLM提供商
   - 输入API Key
   - 选择模型
   - 测试连接
6. 完成设置，进入主界面
7. 开始浏览和保存网页

### 5.2 日常使用流程

**场景1：浏览并保存网页**
1. 在应用的地址栏输入URL或点击链接浏览网页
2. 阅读感兴趣的内容
3. 点击工具栏的"保存"按钮或按Cmd/Ctrl+S
4. 弹出预览窗口：
   - 显示Readability提取的内容
   - 可手动调整裁剪范围
   - 添加标签和备注
   - 选择是否立即生成摘要
5. 确认保存
6. 后台处理：
   - 提取内容和图片
   - 调用LLM生成摘要（如果选择）
   - 生成HTML和JSON格式的邮件
   - 通过SMTP发送到邮箱（多封邮件）
7. 显示成功通知
8. 侧边栏自动更新，显示新保存的条目

**场景2：批量处理模式**
1. 用户快速保存多个网页（不立即生成摘要）
2. 所有内容通过用户SMTP发送到邮箱
3. 稍后在管理界面批量选择
4. 一次性调用用户配置的LLM生成所有摘要
5. 更新邮件内容

**场景3：管理和查看文摘**
1. 在侧边栏浏览已保存的文摘列表
2. 使用搜索框快速查找
3. 点击某个条目
4. 在主浏览区域显示详细内容
5. 可以：
   - 重新生成摘要
   - 编辑备注和标签
   - 导出为Markdown/PDF
   - 删除或归档

**场景4：同步邮箱数据**
1. 点击工具栏的"同步"按钮
2. 应用通过IMAP连接邮箱
3. 读取新的文摘邮件（增量同步）
4. 解析HTML和JSON格式的邮件
5. 更新本地缓存
6. 侧边栏显示同步完成的通知

## 6. 数据格式设计

### 6.1 邮件数据格式（灵活设计原则）

**核心理念**：
- 邮箱仅作为存储介质，不受限于传统邮件格式
- 可使用自定义数据结构（如BASE64编码的JSON）
- 标签系统自行设计，不依赖邮箱的文件夹/标签功能
- 图片可拆分到不同邮件，通过ID关联

**邮件主题格式（示例）**：
```
[EmailDigest] {标题} - {日期} - {内容类型标识}
```

**邮件正文结构（可选方案1 - HTML格式）**：
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>/* 邮件样式 */</style>
</head>
<body>
    <div class="email-digest">
        <header>
            <h1>{标题}</h1>
            <div class="meta">
                <p>原始链接: <a href="{url}">{url}</a></p>
                <p>保存时间: {timestamp}</p>
                <p>标签: {tags}</p>
            </div>
        </header>

        <section class="summary">
            <h2>📝 AI摘要</h2>
            <div>{AI生成的摘要}</div>
        </section>

        <section class="content">
            <h2>📄 原始内容</h2>
            <div>{网页正文内容}</div>
        </section>

        <footer>
            <p>由 Email Digest Assistant 生成</p>
            <p>数据ID: {unique-id}</p>
        </footer>
    </div>
</body>
</html>
```

**邮件正文结构（可选方案2 - 自定义格式）**：
```
<!-- EMAIL_DIGEST_DATA_V1 -->
<base64-encoded-json>
{
  "version": "1.0",
  "id": "unique-id",
  "type": "article|image|metadata",
  "title": "文章标题",
  "url": "原始URL",
  "content": "正文内容",
  "summary": "AI摘要",
  "tags": ["tag1", "tag2"],
  "images": ["image-email-id-1", "image-email-id-2"],
  "createdAt": 1234567890,
  "metadata": {...}
}
</base64-encoded-json>
```

**图片存储策略**：
- 图片作为单独的邮件存储（避免单封邮件过大）
- 通过唯一ID关联到对应的文章邮件
- 可将大图片拆分成多个部分存储

### 6.2 本地缓存数据结构
```typescript
interface DigestItem {
  id: string;                    // 唯一标识
  title: string;                 // 标题
  url: string;                   // 原始URL
  content: string;               // 正文内容
  summary?: string;              // AI摘要
  summaryType?: string;          // 摘要类型
  tags: string[];                // 标签
  createdAt: number;             // 创建时间戳
  updatedAt: number;             // 更新时间戳
  emailId?: string;              // 邮件ID
  source: {                      // 来源信息
    domain: string;
    author?: string;
    publishDate?: string;
  };
  metadata: {                    // 元数据
    wordCount: number;
    readingTime: number;         // 预估阅读时间（分钟）
    language: string;
  };
  status: 'pending' | 'sent' | 'failed';
  note?: string;                 // 用户备注
}

// 安全存储的数据结构
interface UserConfig {
  smtp: {
    host: string;                // SMTP服务器
    port: number;                // SMTP端口
    secure: boolean;             // 是否启用SSL
    username: string;            // 邮箱地址
    password: string;            // 应用密码/授权码（加密存储）
  };
  llm: {
    provider: string;            // LLM提供商
    apiKey: string;              // API Key（加密存储）
    model: string;               // 模型名称
    temperature?: number;        // 生成温度
  };
}
```

## 7. 核心功能实现细节

### 7.1 内容提取算法
- 使用 Mozilla Readability 或类似库
- 清理广告和无关内容
- 保留文章结构和格式
- 提取图片（可选）
- 处理特殊网站（Twitter、Reddit等）

**准确率预期**：
- 新闻网站（如BBC、CNN）：95%+ 准确率
- 博客网站（如Medium、技术博客）：90%+ 准确率
- 论坛（如Reddit）：70-80% 准确率
- 电商网站：50-60% 准确率
- 社交媒体：30-50% 准确率

### 7.2 邮件发送策略
- 用户自提供SMTP配置
- 队列管理：避免频繁发送触发限制
- 重试机制：发送失败自动重试
- 批量发送：合并多个内容到一封邮件
- 错误处理：记录失败原因，提供重发选项

### 7.3 LLM摘要生成
**Prompt模板示例**：
```
请为以下文章生成一个简洁的中文摘要（约150字）：

标题：{title}
来源：{url}
内容：
{content}

要求：
1. 提取核心观点和关键信息
2. 使用清晰简洁的语言
3. 保持客观中立
4. 如果是技术文章，保留重要的技术术语
```

**优化策略**：
- Token限制：截取文章前N字符
- 缓存：相同内容不重复生成
- 流式输出：提升用户体验
- 错误处理：API失败时的降级方案

### 7.4 搜索与筛选
- 全文搜索：使用 Fuse.js 或类似库
- 标签筛选
- 日期范围筛选
- 来源网站筛选
- 排序：按日期、相关度

## 8. 安全与隐私

### 8.1 数据安全（已确定加密方案）
- **PIN码加密机制**：
  - 用户首次使用时设置主PIN码
  - 使用PIN码派生加密密钥（PBKDF2或类似算法）
  - 所有敏感信息（SMTP凭据、API Key）使用该密钥加密
- **跨设备同步安全**：
  - 支持使用Chrome Storage API的sync storage同步加密数据
  - 在新设备上需要重新输入PIN码才能解密
  - 同步过程：旧PIN解密 → 用户设置新PIN → 新PIN加密
- **数据隔离**：
  - 所有用户凭据仅存储在本地
  - 不向第三方服务器发送用户数据（除了必要的SMTP/IMAP/LLM API调用）
- **传输安全**：所有邮件通信必须使用TLS/SSL加密

### 8.2 隐私保护
- 明确告知用户数据流向
- 用户完全控制自己的数据和成本
- 可选择本地LLM（不发送数据到云端）
- 提供数据导出和删除功能

### 8.3 权限申请
浏览器插件需要的权限：
- `activeTab`: 读取当前标签页内容
- `storage`: 本地存储配置
- `contextMenus`: 右键菜单
- `notifications`: 显示通知
- host permissions: 访问用户指定的网站和LLM API

## 9. 用户界面设计（Electron桌面应用）

### 9.1 主窗口布局
```
┌─────────────────────────────────────────────────────┐
│ [<] [>] [⟳]  [地址栏: https://example.com ]  💾 🔄 ⚙ │
├──────────┬──────────────────────────────────────────┤
│          │                                          │
│  侧边栏  │          主浏览区域                       │
│          │                                          │
│  📋文摘  │      (BrowserView 显示网页)               │
│  ───────│                                          │
│  文章1   │                                          │
│  文章2   │                                          │
│  文章3   │                                          │
│          │                                          │
│  🔍搜索  │                                          │
│          │                                          │
└──────────┴──────────────────────────────────────────┘
```

**工具栏**（极简Chrome风格）：
- 前进/后退/刷新按钮
- 地址栏
- 保存按钮（💾图标）
- 同步按钮（🔄图标）
- 设置按钮（⚙图标）

### 9.2 侧边栏（文摘管理）
**侧边栏功能**：
- 始终显示（可折叠）
- 位置：左侧或右侧（用户可配置）
- 宽度：可调整

**侧边栏内容**：
- 搜索框
- 筛选器（日期、标签）
- 文摘列表：
  - 列表视图：标题 + 摘要预览 + 日期
  - 卡片视图：带图片的卡片展示
- 标签云（可选）

### 9.3 保存预览窗口
弹出式对话框：
- 提取内容预览
- 可编辑的内容选择框
- 标签输入（支持自动完成）
- 备注输入
- 选项：
  - ☑️ 立即生成摘要
  - ☑️ 保存图片
- 按钮：保存 / 取消

### 9.4 设置页面
独立窗口或主窗口切换：
- **邮箱配置**：
  - 邮箱地址
  - 密码/应用专用密码
  - SMTP/IMAP服务器（自动检测或手动）
  - 连接测试
- **LLM配置**：
  - 提供商选择
  - API Key
  - 模型选择
  - 测试连接
- **界面设置**：
  - 深色/浅色主题
  - 侧边栏位置
  - 字体大小
- **高级设置**：
  - 缓存管理
  - 数据导入/导出
  - 快捷键自定义

### 9.5 UI/UX原则
- **极简设计**：类似Chrome的极简风格
- **即时反馈**：操作立即响应
- **键盘优先**：支持完整的键盘操作
- **深色模式**：默认支持系统主题切换
- **原生体验**：遵循各平台的设计规范

## 10. 技术难点与解决方案（Electron版本）

### 10.1 Electron环境下的SMTP/IMAP实现
**解决方案**：使用成熟的Node.js库

- **SMTP客户端**：
  - 使用**nodemailer**库
  - 完整的SMTP协议支持
  - 自动处理TLS/SSL
  - 队列管理和重试机制
  - 支持所有主流邮箱服务商

- **IMAP客户端**：
  - 使用**node-imap**或**imap-simple**
  - 解析自定义邮件格式
  - 增量同步算法
  - 错误处理和重连机制

- **技术优势**：
  - 无浏览器限制，直接使用Node.js生态
  - 成熟的库，稳定性高
  - 开发成本低

### 10.2 内容提取的准确性（已确定方案）
**问题**：不同网站结构差异大，特别是SPA应用

**解决方案**：
- **基础提取**：使用Mozilla Readability库提取DOM内容
- **用户辅助**：
  - 提供内容预览窗口
  - 允许用户手动裁剪和选择内容区域
  - 用户可调整提取范围
- **图片处理**：
  - 不保存URL引用（避免图床失效）
  - 完整存储图片内容到邮件
  - 可将图片拆分到不同邮件存储
- **假设前提**：用户会等待页面完全加载后再进行收藏

### 10.3 LLM API的成本和用户控制（已确定方案）
**问题**：LLM API成本由用户承担，需要优化使用

**解决方案**：
- **批量处理模式**：
  - 用户可快速保存多个网页（不立即生成摘要）
  - 稍后在管理界面统一生成所有摘要
  - 减少API调用次数
- **长文处理**：
  - 对于特别长的文章，采用分段摘要后合并策略
  - 避免超出LLM的token限制
- **失败处理**：
  - 降级保存：仅保存原文，标记为"未生成摘要"
  - 允许用户稍后手动重新生成
  - 提示用户检查LLM配置
- **缓存机制**：
  - 本地缓存已生成的摘要
  - 相同内容不重复生成
- **成本透明**：明确告知用户API使用情况

### 10.4 Electron的跨平台兼容性
**问题**：Windows/macOS/Linux的差异

**解决方案**：
- 使用electron-builder统一打包
- 针对不同平台的UI适配
- 测试覆盖三大平台
- 文件路径使用path模块处理

### 10.5 BrowserView的内容提取
**问题**：如何从BrowserView中提取网页内容

**解决方案**：
```javascript
// 使用webContents.executeJavaScript
const content = await browserView.webContents.executeJavaScript(`
  const { Readability } = require('@mozilla/readability');
  const reader = new Readability(document.cloneNode(true));
  const article = reader.parse();
  article;
`);
```

### 10.6 大文件和图片的处理
**问题**：单封邮件大小限制

**解决方案**：
- 单封邮件限制5MB
- 图片自动拆分存储
- 使用BASE64编码
- 通过邮件主题ID关联

## 11. 开发计划

### 11.1 MVP版本（Phase 1）- Electron版本
**预计时间**：6-8周

**核心功能**：
- ✅ Electron应用框架搭建（React + TypeScript + Vite）
- ✅ 基础浏览器功能（地址栏、前进/后退、BrowserView）
- ✅ SMTP/IMAP集成（使用nodemailer和node-imap）
- ✅ 内容提取功能（Readability + 预览裁剪）
- ✅ 侧边栏文摘管理界面（列表、搜索）
- ✅ OpenAI集成（用户自提供API Key）
- ✅ 批量处理模式（快速保存，稍后生成摘要）
- ✅ PIN码加密存储（文件系统存储）
- ✅ 图片完整存储（拆分到多封邮件）
- ✅ 手动同步机制
- ✅ 基本设置页面
- ✅ 跨平台打包（Windows/macOS/Linux）

**技术优先级**：
1. **Electron基础框架搭建**
   - 主进程和渲染进程架构
   - BrowserView集成
   - IPC通信机制
2. **SMTP/IMAP功能实现**
   - nodemailer配置和测试
   - node-imap读取和解析
   - 分离存储HTML和JSON邮件
3. **浏览器UI和内容提取**
   - 地址栏和导航
   - Readability集成
   - 预览和裁剪界面
4. **侧边栏管理界面**
   - 文摘列表展示
   - 搜索和筛选
   - 与邮箱数据同步
5. **LLM集成和加密存储**
   - OpenAI API调用
   - PIN码加密机制
   - 配置管理

**技术验证项**：
- Electron + Vite + React的集成
- BrowserView的内容提取方案
- nodemailer的多封邮件发送
- 跨平台打包和发布

**目标**：提供完整可用的桌面应用，验证邮件存储方案

### 11.2 完整版（Phase 2）
**预计时间**：4-6周

**新增功能**：
- ✅ 多标签页支持（浏览器多标签）
- ✅ 多LLM提供商支持（Claude、Gemini、本地Ollama等）
- ✅ 高级搜索和筛选（全文搜索索引）
- ✅ 智能标签系统（自动分类、AI建议标签）
- ✅ 数据导出功能（Markdown、PDF、HTML、JSON）
- ✅ 性能优化（虚拟滚动、懒加载）
- ✅ 书签和历史记录功能
- ✅ 快捷键完整支持
- ✅ 自动更新机制

### 11.3 增强版（Phase 3）
**预计时间**：4-6周

**新增功能**：
- ✅ 本地LLM支持（Ollama集成）
- ✅ 更多摘要模式
- ✅ 浏览器同步
- ✅ 分享功能
- ✅ 移动端伴侣应用（可选）
- ✅ 高级统计和可视化
- ✅ 智能推荐

## 12. 成功指标

### 12.1 产品指标
- 用户留存率：7日留存 > 40%
- 日活跃用户（DAU）
- 平均每用户保存文章数 > 5篇/周
- 摘要生成使用率 > 60%

### 12.2 技术指标
- 内容提取准确率（目标降低到80%现实预期）
- 页面加载时间 < 2秒
- 摘要生成时间 < 10秒
- 邮件发送成功率 > 95%
- 插件crash率 < 1%

### 12.3 用户满意度
- Chrome商店评分 > 4.5星
- 用户反馈响应率 > 80%
- NPS (Net Promoter Score) > 50

## 13. 风险评估

### 13.1 技术风险
| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| SMTP库兼容性 | 高 | 中 | 充分测试，多种实现方案备选 |
| 邮箱服务商限制 | 中 | 中 | 用户自配置，降低集中风险 |
| LLM API不稳定 | 中 | 中 | 支持多个LLM提供商，本地模型备选 |
| 内容提取失败 | 中 | 低 | 手动选择机制，备选保存URL |
| 浏览器政策变化 | 高 | 低 | 关注官方动态，及时适配 |

### 13.2 业务风险
| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| 用户隐私担忧 | 高 | 中 | 透明隐私政策，本地化存储 |
| 竞品出现 | 中 | 中 | 强化差异化功能，提升用户体验 |
| LLM成本用户承担 | 中 | 中 | 明确成本透明，提供免费选项 |

## 14. 商业模式

### 14.1 完全免费模式
- **插件本身**：完全免费，无任何付费功能
- **邮箱服务**：用户自己的邮箱账户，无需额外费用
- **LLM服务**：用户自己提供API Key，自行承担API调用费用
- **数据存储**：使用用户自己的邮箱，无需额外存储成本
- **服务成本**：零基础设施成本，专注前端开发

**商业模式优势**：
- 零门槛用户体验
- 避免复杂的付费逻辑
- 用户完全控制自己的数据和成本
- 降低项目运营风险
- 符合开源社区价值观

### 14.2 未来增值方向（可选）
- **技术支持服务**：为有需要的用户提供技术支持和定制开发
- **企业版本**：针对企业用户的团队协作和高级管理功能
- **开源贡献**：回馈开源社区，建立技术影响力
- **社区驱动**：通过GitHub等平台建立开源社区

## 15. 后续扩展方向

### 15.1 功能扩展
- 📱 移动端应用
- 🤝 团队协作版本
- 🔗 与笔记应用集成（Notion、Obsidian）
- 📊 知识图谱可视化
- 🎯 智能推荐系统
- 🌐 多语言支持

### 15.2 AI能力扩展
- 自动分类和打标签
- 内容关联分析
- 趋势分析
- 自动生成学习路径
- 问答系统（基于保存的内容）

## 16. 参考资料

### 16.1 相似产品
- Pocket：稍后阅读应用
- Instapaper：稍后阅读和标注
- Raindrop.io：书签管理
- Matter：阅读应用
- Readwise：阅读笔记管理

### 16.2 技术参考
- Mozilla Readability：内容提取
- WebExtension API：浏览器插件开发
- nodemailer：SMTP邮件发送
- OpenAI API：LLM集成
- Chrome Extension Storage API：加密存储

---

## 附录：常见问题解答（FAQ）

**Q: 为什么选择邮件作为存储方式？**
A: 邮件系统具有以下优势：
- 普及性高，人人都有邮箱
- 跨平台访问方便
- 存储容量大且免费
- 数据完全归用户所有
- 不依赖特定服务商

**Q: 邮件存储会不会很混乱？**
A: 不会。插件会自动创建专门的文件夹/标签，所有文摘内容会统一管理，不会影响正常邮件使用。

**Q: LLM摘要需要花钱吗？**
A: 如果使用OpenAI等云端服务，需要您自行配置API Key并承担API调用费用。我们也支持本地LLM（如Ollama），完全免费。

**Q: 数据安全吗？**
A: 非常安全。所有数据存储在您自己的邮箱中，SMTP凭据和API Key等敏感信息仅加密存储在本地，我们不会收集或传输您的任何个人数据。

**Q: 支持哪些浏览器？**
A: 首先支持Chrome和Edge，后续会扩展到Firefox和Safari。

**Q: 可以导出数据吗？**
A: 可以。支持导出为Markdown、HTML、PDF等多种格式。

**Q: 如何确保SMTP配置安全？**
A: 您的SMTP凭据（用户名、密码）将使用Chrome Extension Storage API进行本地加密存储，绝不会发送到我们的服务器。

**Q: LLM API调用失败怎么办？**
A: 我们提供多种备选方案：
- 支持多个LLM提供商
- 可选择本地LLM（Ollama）
- 提供手动摘要选项
- 缓存机制避免重复调用

---

---

## 17. 技术决策总结（Electron版本）

通过充分讨论，项目已从浏览器插件调整为Electron桌面应用，以下是最终确定的技术决策：

### 17.1 架构决策
**核心决定**：采用Electron桌面应用架构（放弃浏览器插件方案）

**理由**：
1. **开发者友好**：无需OAuth2等复杂配置，开发者克隆即用
2. **技术能力完整**：直接使用Node.js生态，支持所有邮箱服务商
3. **用户体验简单**：仅需输入邮箱和密码，无需复杂授权流程
4. **更适合开源**：降低贡献者门槛，提高项目可维护性

### 17.2 核心技术栈
- **应用框架**: Electron（最新稳定版）
- **前端框架**: React 18+ + TypeScript 5.0+
- **构建工具**: Vite + electron-builder
- **状态管理**: Zustand 或 Redux Toolkit
- **样式方案**: Tailwind CSS
- **打包发布**: electron-builder（支持Windows/macOS/Linux）

### 17.3 邮件协议实现
- **SMTP**: nodemailer（成熟的Node.js库）
  - 支持所有提供SMTP的邮箱服务商
  - 自动处理TLS/SSL加密
  - 认证方式: PLAIN、LOGIN（优先）
- **IMAP**: node-imap 或 imap-simple
  - 手动触发同步
  - 解析自定义邮件格式（HTML和JSON分离）
  - 增量同步算法

### 17.4 数据存储策略
- **邮箱存储**: 仅作为存储介质
  - 分离存储：HTML邮件（可读）+ JSON邮件（程序解析）
  - 图片单独存储（5MB限制，拆分机制）
  - 通过邮件主题ID关联
- **本地缓存**: Node.js文件系统（取代IndexedDB）
  - 仅缓存元数据和文字内容
  - 图片需要时从邮箱获取
  - 目录结构：config/ cache/ temp/

### 17.5 安全机制
- **加密方案**: PIN码 + PBKDF2派生密钥
- **跨设备同步**: 支持通过邮箱同步数据，新设备需重新设置PIN
- **传输安全**: 所有邮件通信使用TLS/SSL
- **本地存储**: 敏感信息加密存储在文件系统

### 17.6 产品体验
- **产品形态**: 桌面浏览器应用
- **UI风格**: 极简Chrome风格，侧边栏文摘管理
- **内容捕获**: 工具栏按钮 + 右键菜单 + 快捷键（Cmd/Ctrl+S）
- **内容提取**: Readability + 用户预览裁剪
- **批量处理**: 快速保存模式，稍后统一生成摘要
- **长文摘要**: 分段处理后合并
- **同步机制**: 手动同步（用户点击按钮）

### 17.7 MVP范围
**核心功能**（6-8周）：
1. 基础浏览器功能（BrowserView）
2. SMTP/IMAP邮件收发
3. 内容提取和预览
4. 侧边栏文摘管理
5. LLM摘要生成
6. PIN码加密存储
7. 跨平台打包

**Phase 2功能**（4-6周）：
- 多标签页、多LLM提供商、高级搜索、智能标签、数据导出

### 17.8 技术优势总结
相比浏览器插件方案：
- ✅ 无需处理浏览器API限制
- ✅ 直接使用成熟的Node.js邮件库
- ✅ 更简单的用户配置流程
- ✅ 更低的开发和维护成本
- ✅ 更适合开源社区协作
- ✅ 完整的文件系统访问能力

---

**文档版本**：v4.0（Electron架构确定版）
**创建日期**：2024年
**最后更新**：2025年1月16日
**文档状态**：技术架构已确定为Electron，可进入技术方案设计和开发阶段
